!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var a=e();for(var n in a)("object"==typeof exports?exports:t)[n]=a[n]}}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function a(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=1)}([function(t,e,a){"use strict";e.__esModule=!0;var n=function(t){for(var e=arguments.length,a=Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];var r;if(window.hasOwnProperty("wx")&&window.wx.hasOwnProperty(t))return(r=window.wx)[t].apply(r,a)},r="${env}",i=0,o=0,u=0,l=0;function f(t){if("production"!=r){for(var e,a=arguments.length,n=Array(a>1?a-1:0),i=1;i<a;i++)n[i-1]=arguments[i];(e=console).log.apply(e,["WXRank",t].concat(n))}}e.default={getOffestX:function(){return i},getOffestY:function(){return o},getDesignWidth:function(){return u},getDesignHeight:function(){return l},init:function(t){console.log("WXRank","init,version:1.0.0"),Laya.MiniAdpter.init(!0,!0),Laya.init(750,1334),function(t){n("onMessage",function(e){t&&t(e)})}(function(e){try{"filedata"===e.isLoad?(Laya.MiniFileMgr.ziyuFileData[e.url]=e.data,Laya.loader.load(e.url)):"filenative"==e.isLoad?e.isAdd?Laya.MiniFileMgr.filesListObj[e.url]=e.data:delete Laya.MiniFileMgr.filesListObj[e.url]:(f("OnMessage:",e),e.action&&"initRank"===e.action&&e.data?(Laya.stage.width=e.data.width,Laya.stage.height=e.data.height,i=e.data.offsetX,o=e.data.offsetY,u=e.data.designWidth,l=e.data.designHeight,Laya.stage.frameRate=Laya.Stage.FRAME_SLOW,Laya.stage.scaleMode=Laya.Stage.SCALE_EXACTFIT):t&&t(e))}catch(t){f("Error",t)}})},setUserCloudStorage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("setUserCloudStorage",t)},getUserCloudStorage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("getUserCloudStorage",t)},removeUserCloudStorage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("removeUserCloudStorage",t)},getFriendCloudStorage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("getFriendCloudStorage",t)},getGroupCloudStorage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("getGroupCloudStorage",t)},getUserInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("getUserInfo",t)},printDebug:f}},function(t,e,a){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(a(0)),r=a(2);n.default.init(function(t){"showRank"===t.action&&t.data?(0,r.showRank)(t.data.ui):"hideRank"===t.action&&t.data?(0,r.hideRank)():"setRankKey"===t.action&&t.data?(0,r.setRankKey)(t.data.key,t.data.count,t.data.offset):"setRankScore"===t.action&&t.data&&(0,r.setRankScore)(t.data.key,t.data.score,t.data.extraData)})},function(t,e,a){"use strict";e.__esModule=!0,e.setRankKey=function(t,e,a){u=t,c=e,d=a,g()},e.setRankScore=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=[{key:t,value:JSON.stringify({wxgame:{score:e,update_time:Math.floor(Date.now()/1e3)},extraData:a})}];n.default.setUserCloudStorage({KVDataList:r,success:function(){t==u&&g()}})},e.showRank=function(t){l&&JSON.stringify(t)===JSON.stringify(l)||(l=t,function(){if(!l)return;if(Laya.stage.destroyChildren(),l instanceof Array)l.forEach(function(t){var e=Laya.View.createComp(t);e&&((0,r.bindView)(e,o),Laya.stage.addChild(e))});else{var t=Laya.View.createComp(l);t&&(t.x=n.default.getOffestX(),t.y=n.default.getOffestY(),(0,r.bindView)(t,o),Laya.stage.addChild(t))}}());g()},e.hideRank=function(){l=null,Laya.stage.destroyChildren()};var n=function(t){return t&&t.__esModule?t:{default:t}}(a(0)),r=a(3),i=a(4);var o={},u=null,l=null,f=!0,s=null,c=100,d=0;function g(){s||(s=setTimeout(function(){s=null,l&&u&&f&&(f=!1,(0,i.fetchRankData)(u,c,d,function(t){n.default.printDebug("rankData:",t),o=t,f=!0;for(var e=0;e<Laya.stage.numChildren;e++)(0,r.bindView)(Laya.stage.getChildAt(e),o)}))},200))}},function(t,e,a){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t}function i(t,e){var a=e.split("|"),n=a[0],i=r(t);if(t)if(t[n])i=r(t[n]);else{n.split(".").forEach(function(t){i=null!==i&&void 0!==i&&null!==i[t]&&void 0!==i[t]?r(i[t]):null})}else i=null;for(var o=[],u=1;u<a.length;u+=2){var l=a[u],f=a.length>u+1?a[u+1]:"";o.push({action:l,target:f})}for(var s=null,c=0;c<o.length;c++){var d=o[c],g=d.action,y=d.target;"default"===g&&(s=y),null!==i&&void 0!==i?"eq"===g&&y!==i.toString()||"neq"===g&&y===i.toString()||"gt"===g&&i<=y||"egt"===g&&i<y||"lt"===g&&i>=y||"elt"===g&&i>y||"like"===g&&i.toString().indexOf(y)<0?i=null:"sub"===g?1*y>0&&(i=i.toString().substr(0,1*y)):"append"===g&&(i=i.toString()+y):i=null}return null===i&&(i=s),i}e.bindView=function t(e,a){var o=this;var u=r(a);for(var l=0;l<e.numChildren;l++){var f=e.getChildAt(l);if(f.name){var s=i(u,f.name);null!==s&&void 0!==s?(f.visible=!0,f instanceof Laya.List?function(){var e=f;e.array=[],e.repeatX>1&&!e.hScrollBarSkin&&(e.hScrollBarSkin=null),e.repeatY>1&&!e.vScrollBarSkin&&(e.vScrollBarSkin=null),e.renderHandler=Laya.Handler.create(o,function(a,r){var i=e.array[r];"object"===(void 0===i?"undefined":n(i))&&Object.assign(i,{index:r}),t(a,i)},null,!1),e.array=s}():f instanceof Laya.FontClip?f.value=""+s:f instanceof Laya.Label?f.text=""+s:f instanceof Laya.Text?f.text=""+s:f instanceof Laya.Image?f.skin=s:f instanceof Laya.Box?t(f,s):f.value=s):f.visible=!1}}}},function(t,e,a){"use strict";e.__esModule=!0,e.fetchRankData=function(t,e,a,n){var o={};r(function(r){i(r,t,e,a,function(t){Object.assign(o,t),n&&n(o)})})};var n=function(t){return t&&t.__esModule?t:{default:t}}(a(0));var r=function(t){n.default.getUserInfo({openIdList:["selfOpenId"],success:function(e){var a=e.data[0],n={playerId:a.openId,nickname:a.nickName,avatarUrl:a.avatarUrl};t&&t(n)}})},i=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments[4];n.default.getFriendCloudStorage({keyList:[e],success:function(n){var o=[];n&&n.data&&n.data.length>0&&(o=n.data);var u=-1,l=null,f=null,s=[],c=o.map(function(t){var a={};t.KVDataList.forEach(function(t){a[t.key]=t.value});var n,r=t.openid,i=t.nickname,o=t.avatarUrl,u=0,l=0,f=function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t}(a[e])||{};return n=f.extraData||"",f.wxgame&&(l=f.wxgame.score||0,u=f.wxgame.update_time||0),{playerId:r,nickname:i,avatarUrl:o,score:l,timestamp:u,extraData:n}}).sort(function(t,e){return e.score-t.score}).splice(r,a).map(function(e,a){var n=e.nickname===t.nickname&&e.avatarUrl===t.avatarUrl;return n&&(f=e,u=a,l={score:e.score,extraData:e.extraData}),Object.assign(e,{self:n,rank:a+1}),e});s=u<=0?c.slice(0,3):c.slice(u-1,u+1),i&&i({selfInfo:t,rankList:c,rankSelf:f,selfData:l,rankThree:s})}})}}])});