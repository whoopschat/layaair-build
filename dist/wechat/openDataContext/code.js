!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var n in a)("object"==typeof exports?exports:e)[n]=a[n]}}(window,function(){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";a.r(t);const n=(e,...t)=>{if(window.hasOwnProperty("wx")&&window.wx.hasOwnProperty(e))return window.wx[e](...t)};let r="${env}",i=0,o=0,l=0,s=0;function u(e,...t){"production"!=r&&console.log("WXRank",e,...t)}var c={getOffestX:function(){return i},getOffestY:function(){return o},getDesignWidth:function(){return l},getDesignHeight:function(){return s},init:e=>{console.log("WXRank","init,version:1.0.0"),Laya.MiniAdpter.init(!0,!0),Laya.init(750,1334),(e=>{n("onMessage",t=>{e&&e(t)})})(t=>{try{"filedata"===t.isLoad?(Laya.MiniFileMgr.ziyuFileData[t.url]=t.data,Laya.loader.load(t.url)):"filenative"==t.isLoad?t.isAdd?Laya.MiniFileMgr.filesListObj[t.url]=t.data:delete Laya.MiniFileMgr.filesListObj[t.url]:(u("OnMessage:",t),t.action&&"initRank"===t.action&&t.data?(Laya.stage.width=t.data.width,Laya.stage.height=t.data.height,i=t.data.offsetX,o=t.data.offsetY,l=t.data.designWidth,s=t.data.designHeight,Laya.stage.frameRate=Laya.Stage.FRAME_SLOW,Laya.stage.scaleMode=Laya.Stage.SCALE_EXACTFIT):e&&e(t))}catch(e){u("Error",e)}})},setUserCloudStorage:function(e={}){n("setUserCloudStorage",e)},getUserCloudStorage:function(e={}){n("getUserCloudStorage",e)},removeUserCloudStorage:function(e={}){n("removeUserCloudStorage",e)},getFriendCloudStorage:function(e={}){n("getFriendCloudStorage",e)},getGroupCloudStorage:function(e={}){n("getGroupCloudStorage",e)},getUserInfo:function(e={}){n("getUserInfo",e)},printDebug:u};function f(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e}function d(e,t){let a=t.split("|"),n=a[0],r=f(e);e?e[n]?r=f(e[n]):n.split(".").forEach(function(e){r=null!==r&&void 0!==r&&null!==r[e]&&void 0!==r[e]?f(r[e]):null}):r=null;let i=[];for(let e=1;e<a.length;e+=2){const t=a[e],n=a.length>e+1?a[e+1]:"";i.push({action:t,target:n})}let o=null;for(let e=0;e<i.length;e++){const{action:t,target:a}=i[e];"default"===t&&(o=a),null!==r&&void 0!==r?"eq"===t&&a!==r.toString()||"neq"===t&&a===r.toString()||"gt"===t&&r<=a||"egt"===t&&r<a||"lt"===t&&r>=a||"elt"===t&&r>a||"like"===t&&r.toString().indexOf(a)<0?r=null:"sub"===t?1*a>0&&(r=r.toString().substr(0,1*a)):"append"===t&&(r=r.toString()+a):r=null}return null===r&&(r=o),r}function g(e,t){for(var a=f(t),n=0;n<e.numChildren;n++){var r=e.getChildAt(n);if(r.name){var i=d(a,r.name);if(null!==i&&void 0!==i)if(r.visible=!0,r instanceof Laya.List){const e=r;e.array=[],e.repeatX>1&&!e.hScrollBarSkin&&(e.hScrollBarSkin=null),e.repeatY>1&&!e.vScrollBarSkin&&(e.vScrollBarSkin=null),e.renderHandler=Laya.Handler.create(this,function(t,a){var n=e.array[a];"object"==typeof n&&Object.assign(n,{index:a}),g(t,n)},null,!1),e.array=i}else r instanceof Laya.FontClip?r.value=`${i}`:r instanceof Laya.Label?r.text=`${i}`:r instanceof Laya.Text?r.text=`${i}`:r instanceof Laya.Image?r.skin=i:r instanceof Laya.Box?g(r,i):r.value=i;else r.visible=!1}}}const y=e=>{c.getUserInfo({openIdList:["selfOpenId"],success:function(t){let a=t.data[0],n={playerId:a.openId,nickname:a.nickName,avatarUrl:a.avatarUrl};e&&e(n)}})},p=(e,t,a=100,n=0,r)=>{c.getFriendCloudStorage({keyList:[t],success:function(i){let o=[];i&&i.data&&i.data.length>0&&(o=i.data);let l=-1,s=null,u=null,c=[],f=o.map(e=>{let a={};e.KVDataList.forEach(e=>{a[e.key]=e.value});let n=e.openid,r=e.nickname,i=e.avatarUrl,o=0,l=0,s="",u=function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e}(a[t])||{};return s=u.extraData||"",u.wxgame&&(l=u.wxgame.score||0,o=u.wxgame.update_time||0),{playerId:n,nickname:r,avatarUrl:i,score:l,timestamp:o,extraData:s}}).sort(function(e,t){return t.score-e.score}).splice(n,a).map((t,a)=>{let n=t.nickname===e.nickname&&t.avatarUrl===e.avatarUrl;return n&&(u=t,l=a,s={score:t.score,extraData:t.extraData}),Object.assign(t,{self:n,rank:a+1}),t});c=l<=0?f.slice(0,3):f.slice(l-1,l+1),r&&r({selfInfo:e,rankList:f,rankSelf:u,selfData:s,rankThree:c})}})};let S={},v=null,L=null,h=!0,m=null,b=100,k=0;function x(){m||(m=setTimeout(()=>{m=null,L&&v&&h&&(h=!1,function(e,t,a,n){let r={};y(i=>{p(i,e,t,a,e=>{Object.assign(r,e),n&&n(r)})})}(v,b,k,e=>{c.printDebug("rankData:",e),S=e,h=!0;for(let e=0;e<Laya.stage.numChildren;e++)g(Laya.stage.getChildAt(e),S)}))},200))}c.init(e=>{"showRank"===e.action&&e.data?function(e){L&&JSON.stringify(e)===JSON.stringify(L)||(L=e,function(){if(L)if(Laya.stage.destroyChildren(),L instanceof Array)L.forEach(e=>{var t=Laya.View.createComp(e);t&&(g(t,S),Laya.stage.addChild(t))});else{var e=Laya.View.createComp(L);e&&(e.x=c.getOffestX(),e.y=c.getOffestY(),g(e,S),Laya.stage.addChild(e))}}()),x()}(e.data.ui):"hideRank"===e.action&&e.data?(L=null,Laya.stage.destroyChildren()):"setRankKey"===e.action&&e.data?function(e,t,a){v=e,b=t,k=a,x()}(e.data.key,e.data.count,e.data.offset):"setRankScore"===e.action&&e.data&&function(e,t,a=""){let n=[{key:e,value:JSON.stringify({wxgame:{score:t,update_time:Math.floor(Date.now()/1e3)},extraData:a})}];c.setUserCloudStorage({KVDataList:n,success:()=>{e==v&&x()}})}(e.data.key,e.data.score,e.data.extraData)})}])});